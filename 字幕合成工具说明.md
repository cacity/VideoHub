# 字幕视频合成工具

## 功能简介

这是一个简易的字幕视频合成工具，使用 FFmpeg 将 ASS 字幕烧录到视频中。

## 主要特性

- ✅ 支持多种视频格式（MP4、AVI、MKV、MOV、FLV、WMV、WEBM等）
- ✅ 支持 ASS 格式字幕
- ✅ 多种质量模式选择
- ✅ 实时进度显示
- ✅ 支持文件拖放
- ✅ 自动生成输出文件名
- ✅ 详细的合成日志

## 使用方法

### 1. 启动程序

**Windows:**
```bash
双击运行: run_subtitle_merger.bat
或命令行: python subtitle_merger.py
```

**Linux/Mac:**
```bash
chmod +x run_subtitle_merger.sh
./run_subtitle_merger.sh
或: python subtitle_merger.py
```

### 2. 选择文件

1. **视频文件**: 点击"浏览"按钮或直接拖放视频文件到输入框
2. **字幕文件**: 点击"浏览"按钮或直接拖放 ASS 字幕文件到输入框
3. **输出文件**: 自动生成或手动指定输出路径

### 3. 设置参数

**质量模式:**
- **无损（最高质量，文件大）**: H.264 QP=0，完全无损，文件最大
- **极高质量（接近无损）**: H.264 CRF=0，接近无损，文件较大
- **高质量（推荐）**: H.264 CRF=18，视觉无损，推荐使用
- **平衡质量（较快）**: H.264 CRF=23，平衡质量和速度

**音频处理:**
- ☑ 直接复制音频流：不重新编码音频，速度快，质量无损
- ☐ 重新编码音频：使用 AAC 320kbps 编码

### 4. 开始合成

点击"开始合成"按钮，等待处理完成。

## 依赖要求

- Python 3.8+
- PyQt6
- FFmpeg（必须安装并添加到系统 PATH）

### 安装依赖

```bash
pip install PyQt6
```

### 安装 FFmpeg

**Windows:**
1. 下载 FFmpeg: https://ffmpeg.org/download.html
2. 解压到任意目录
3. 将 `bin` 目录添加到系统 PATH

**Linux:**
```bash
sudo apt install ffmpeg  # Ubuntu/Debian
sudo yum install ffmpeg  # CentOS/RHEL
```

**Mac:**
```bash
brew install ffmpeg
```

## FFmpeg 命令说明

程序使用的 FFmpeg 命令格式：

```bash
ffmpeg -i 视频.mp4 -vf "ass='字幕.ass'" -c:v libx264 -crf 18 -c:a copy 输出.mp4
```

**参数说明:**
- `-i`: 输入视频文件
- `-vf "ass='字幕.ass'"`: 烧录 ASS 字幕到视频
- `-c:v libx264`: 使用 H.264 编码器
- `-crf 18`: 质量参数（0=无损，18=视觉无损，23=默认）
- `-c:a copy`: 直接复制音频流
- `-y`: 覆盖已存在的输出文件

## 注意事项

1. **路径问题**: 确保视频和字幕文件路径不包含特殊字符
2. **字幕编码**: ASS 字幕文件建议使用 UTF-8 编码
3. **磁盘空间**: 无损模式会生成非常大的文件，确保有足够磁盘空间
4. **处理时间**: 根据视频长度和质量设置，处理可能需要较长时间
5. **字体问题**: 确保系统已安装 ASS 字幕中使用的字体

## 常见问题

**Q: 提示"未找到 FFmpeg"？**
A: 请确保已安装 FFmpeg 并添加到系统 PATH

**Q: 合成的视频没有显示字幕？**
A: 检查字幕文件路径是否正确，字体是否已安装

**Q: 合成速度很慢？**
A: 可以选择"平衡质量"模式，或使用更快的预设

**Q: 文件太大？**
A: 避免使用"无损"模式，推荐使用"高质量"模式

## 技术支持

如有问题，请检查日志输出了解详细错误信息。
